---
phase: 01-fondations-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/__init__.py
  - src/core/__init__.py
  - src/core/entities/__init__.py
  - src/core/entities/video.py
  - src/core/entities/media.py
  - src/core/ports/__init__.py
  - src/core/ports/repositories.py
  - src/core/ports/api_clients.py
  - src/core/ports/file_system.py
  - src/core/value_objects/__init__.py
  - src/core/value_objects/media_info.py
  - src/services/__init__.py
  - src/adapters/__init__.py
autonomous: true

must_haves:
  truths:
    - "La structure de repertoires core/services/adapters existe"
    - "Les entites domain Video, Movie, Episode sont definies comme dataclasses"
    - "Les ports abstraits (ABCs) definissent les contrats pour repositories et API clients"
    - "Les value objects Resolution, Codec, Language sont immutables"
  artifacts:
    - path: "src/core/__init__.py"
      provides: "Core package initialization"
    - path: "src/core/entities/video.py"
      provides: "Video, Movie, Episode dataclasses"
      contains: "@dataclass"
    - path: "src/core/ports/repositories.py"
      provides: "IVideoRepository, IMovieRepository ABC"
      contains: "class ABC"
    - path: "src/core/value_objects/media_info.py"
      provides: "Resolution, Codec, Language value objects"
      contains: "@dataclass(frozen=True)"
  key_links:
    - from: "src/core/entities/video.py"
      to: "src/core/value_objects/media_info.py"
      via: "imports value objects for composition"
      pattern: "from.*value_objects.*import"
    - from: "src/core/ports/repositories.py"
      to: "src/core/entities/video.py"
      via: "type hints reference entities"
      pattern: "from.*entities.*import"
---

<objective>
Creer la structure de repertoires hexagonale et definir les entites domain avec leurs ports abstraits.

Purpose: Etablir les fondations de l'architecture hexagonale pour permettre une separation claire entre logique metier et implementations.
Output: Structure src/core/ complete avec entities, ports, et value objects.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-fondations-architecture/01-RESEARCH.md
@.planning/phases/01-fondations-architecture/01-CONTEXT.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Creer la structure hexagonale</name>
  <files>
    src/__init__.py
    src/core/__init__.py
    src/core/entities/__init__.py
    src/core/ports/__init__.py
    src/core/value_objects/__init__.py
    src/services/__init__.py
    src/adapters/__init__.py
  </files>
  <action>
Creer la structure de repertoires suivant l'architecture hexagonale:

```
src/
├── __init__.py
├── core/                    # Domain layer
│   ├── __init__.py
│   ├── entities/            # Business entities
│   │   └── __init__.py
│   ├── ports/               # Abstract interfaces (ABCs)
│   │   └── __init__.py
│   └── value_objects/       # Immutable value objects
│       └── __init__.py
├── services/                # Application layer (use cases)
│   └── __init__.py
└── adapters/                # Infrastructure layer
    └── __init__.py
```

Chaque __init__.py doit contenir un docstring decrivant le role du package selon l'architecture hexagonale.

Par exemple pour core/__init__.py:
```python
"""
Core domain layer.

Contains business entities, ports (abstract interfaces), and value objects.
This layer has NO dependencies on infrastructure (adapters, frameworks, databases).
"""
```
  </action>
  <verify>
    python -c "import src; import src.core; import src.services; import src.adapters"
  </verify>
  <done>
    Structure src/core/, src/services/, src/adapters/ existe avec __init__.py importables
  </done>
</task>

<task type="auto">
  <name>Task 2: Creer les value objects immutables</name>
  <files>
    src/core/value_objects/__init__.py
    src/core/value_objects/media_info.py
  </files>
  <action>
Creer les value objects pour les informations techniques des fichiers video.

Dans src/core/value_objects/media_info.py:

1. **Resolution** (frozen dataclass):
   - width: int
   - height: int
   - @property label: str (retourne "4K", "1080p", "720p", "SD" selon height)

2. **VideoCodec** (frozen dataclass):
   - name: str (ex: "HEVC", "H.264", "AV1")
   - profile: Optional[str]

3. **AudioCodec** (frozen dataclass):
   - name: str (ex: "AAC", "DTS-HD", "TrueHD")
   - channels: Optional[str] (ex: "5.1", "7.1", "2.0")

4. **Language** (frozen dataclass):
   - code: str (ISO 639-1, ex: "fr", "en")
   - name: str (ex: "French", "English")

5. **MediaInfo** (frozen dataclass - composite):
   - resolution: Optional[Resolution]
   - video_codec: Optional[VideoCodec]
   - audio_codecs: tuple[AudioCodec, ...] (tuple pour immutabilite)
   - audio_languages: tuple[Language, ...]
   - duration_seconds: Optional[int]

Utiliser `@dataclass(frozen=True)` pour garantir l'immutabilite.
Exporter tous les types dans __init__.py.
  </action>
  <verify>
    python -c "from src.core.value_objects import Resolution, MediaInfo; r = Resolution(1920, 1080); print(r.label)"
  </verify>
  <done>
    Value objects Resolution, VideoCodec, AudioCodec, Language, MediaInfo sont immutables et utilisables
  </done>
</task>

<task type="auto">
  <name>Task 3: Creer les entites domain et ports</name>
  <files>
    src/core/entities/__init__.py
    src/core/entities/video.py
    src/core/entities/media.py
    src/core/ports/__init__.py
    src/core/ports/repositories.py
    src/core/ports/api_clients.py
    src/core/ports/file_system.py
  </files>
  <action>
**Entites dans src/core/entities/:**

1. **video.py** - Entites fichier video:
   - `VideoFile` (dataclass): id, path, filename, size_bytes, hash, media_info (Optional[MediaInfo]), created_at, updated_at
   - `PendingValidation` (dataclass): id, video_file, candidates (list), auto_validated, validation_status (enum: pending, validated, rejected)

2. **media.py** - Entites metadonnees media:
   - `Movie` (dataclass): id, tmdb_id, title, original_title, year, genres (tuple[str]), duration_seconds, overview, poster_path
   - `Series` (dataclass): id, tvdb_id, title, original_title, year, genres (tuple[str]), overview, poster_path
   - `Episode` (dataclass): id, series_id, season_number, episode_number, title, air_date, duration_seconds

**Ports dans src/core/ports/:**

1. **repositories.py** - ABCs pour persistance:
   - `IVideoFileRepository`: get_by_id, get_by_path, get_by_hash, save, delete, list_pending
   - `IMovieRepository`: get_by_id, get_by_tmdb_id, search_by_title, save
   - `ISeriesRepository`: get_by_id, get_by_tvdb_id, search_by_title, save
   - `IEpisodeRepository`: get_by_id, get_by_series, save

2. **api_clients.py** - ABCs pour APIs externes:
   - `IMediaAPIClient` (base): search(query, year) -> list[SearchResult], get_details(id) -> MediaDetails
   - `SearchResult` (dataclass): id, title, year, score, source
   - `MediaDetails` (dataclass): id, title, year, genres, duration, overview, poster_url

3. **file_system.py** - ABCs pour operations fichiers:
   - `IFileSystem`: exists, read_metadata, move, copy, delete, calculate_hash
   - `ISymlinkManager`: create_symlink, remove_symlink, is_symlink, resolve_target, find_broken_links

Utiliser typing.Protocol ou abc.ABC pour les ports.
Ne PAS creer d'implementations - seulement les interfaces.
  </action>
  <verify>
    python -c "from src.core.entities import VideoFile, Movie, Episode; from src.core.ports import IVideoFileRepository, IMediaAPIClient"
  </verify>
  <done>
    Entites VideoFile, Movie, Series, Episode sont definies.
    Ports IVideoFileRepository, IMovieRepository, IMediaAPIClient, IFileSystem sont declares comme ABCs.
  </done>
</task>

</tasks>

<verification>
```bash
# Structure exists
ls -la src/core/entities/ src/core/ports/ src/core/value_objects/

# All imports work
python -c "
from src.core.entities import VideoFile, Movie, Series, Episode, PendingValidation
from src.core.ports import IVideoFileRepository, IMovieRepository, ISeriesRepository, IMediaAPIClient, IFileSystem, ISymlinkManager
from src.core.value_objects import Resolution, VideoCodec, AudioCodec, Language, MediaInfo

# Value objects are immutable
r = Resolution(1920, 1080)
try:
    r.width = 1280
    print('FAIL: Resolution should be frozen')
except Exception:
    print('OK: Resolution is frozen')

# Entities are dataclasses
from dataclasses import is_dataclass
assert is_dataclass(VideoFile), 'VideoFile should be dataclass'
assert is_dataclass(Movie), 'Movie should be dataclass'

# Ports are abstract
import inspect
assert inspect.isabstract(IVideoFileRepository), 'IVideoFileRepository should be abstract'

print('All verifications passed')
"
```
</verification>

<success_criteria>
1. Structure src/core/, src/services/, src/adapters/ cree avec __init__.py
2. Value objects Resolution, VideoCodec, AudioCodec, Language, MediaInfo sont frozen dataclasses
3. Entites VideoFile, PendingValidation, Movie, Series, Episode sont des dataclasses
4. Ports IVideoFileRepository, IMovieRepository, ISeriesRepository, IEpisodeRepository, IMediaAPIClient, IFileSystem, ISymlinkManager sont des ABCs
5. `python -c "import src.core"` fonctionne sans erreur
</success_criteria>

<output>
After completion, create `.planning/phases/01-fondations-architecture/01-01-SUMMARY.md`
</output>
