{# Arborescence des transferts prévus #}

{# Macro pour un fichier dans l'arborescence #}
{% macro tree_leaf(item) %}
<div class="tree-leaf">
    <div class="tree-leaf-main">
        <svg class="tree-leaf-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="14" height="14">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
        </svg>
        <span class="tree-leaf-name">{{ item.new_filename }}</span>
        <span class="tree-leaf-size">{{ item.source_size }}</span>
        {% if item.pending_id %}
        <button class="tree-leaf-sendback"
                onclick="showSendbackDialog('{{ item.pending_id }}', '{{ item.new_filename|e }}')"
                title="Renvoyer en validation">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <polyline points="1 4 1 10 7 10"/>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
        </button>
        {% endif %}
    </div>
    <div class="tree-leaf-dest">→ {{ item.storage_rel }}</div>
</div>
{% endmacro %}

<div class="transfer-tree">
    {% if tree_data.movies %}
    <div class="tree-section">
        <div class="tree-section-header">
            <div class="tree-section-icon tree-icon-film">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="18" height="18">
                    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                    <line x1="7" y1="2" x2="7" y2="22"/>
                    <line x1="17" y1="2" x2="17" y2="22"/>
                    <line x1="2" y1="12" x2="22" y2="12"/>
                    <line x1="2" y1="7" x2="7" y2="7"/>
                    <line x1="2" y1="17" x2="7" y2="17"/>
                    <line x1="17" y1="7" x2="22" y2="7"/>
                    <line x1="17" y1="17" x2="22" y2="17"/>
                </svg>
            </div>
            <span class="tree-section-title">Films</span>
            <span class="tree-section-count">{{ tree_data.movie_count }}</span>
        </div>
        <div class="tree-branches">
            {% for group in tree_data.movies %}
            {% if group.path %}
            <div class="tree-group">
                <div class="tree-group-label">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="14" height="14">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                    </svg>
                    {{ group.path }}
                </div>
                {% for item in group.files %}
                {{ tree_leaf(item) }}
                {% endfor %}
            </div>
            {% else %}
            {% for item in group.files %}
            {{ tree_leaf(item) }}
            {% endfor %}
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if tree_data.series %}
    <div class="tree-section">
        <div class="tree-section-header">
            <div class="tree-section-icon tree-icon-series">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="18" height="18">
                    <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                    <polyline points="17 2 12 7 7 2"/>
                </svg>
            </div>
            <span class="tree-section-title">Séries</span>
            <span class="tree-section-count">{{ tree_data.series_count }}</span>
        </div>
        <div class="tree-branches">
            {% for group in tree_data.series %}
            {% if group.path %}
            <div class="tree-group">
                <div class="tree-group-label">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="14" height="14">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                    </svg>
                    {{ group.path }}
                </div>
                {% for item in group.files %}
                {{ tree_leaf(item) }}
                {% endfor %}
            </div>
            {% else %}
            {% for item in group.files %}
            {{ tree_leaf(item) }}
            {% endfor %}
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
